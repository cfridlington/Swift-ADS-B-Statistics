# Swift-ADS-B-Statistics

## Overview

Swift ADS-B Statistics is a [Swift Package](https://www.swift.org/packages/) designed to run in conjunction with flight tracking software, such as [FlightRadar24](https://www.flightradar24.com/share-your-data), and the Mode-S decoder [dump1090-mutability](https://github.com/adsb-related-code/dump1090-mutability/tree/master) to process aircraft messages to store historical data and to calculate statistics.

The package operates by reading in the files generated by dump1090-mutability and processing them to create the following new json files:
- `aircraft_frequent_tails.json` is a list of aircraft that have been frequently seen by the ADS-B receiver.
- `aircraft_frequent_types.json` is a list of frequent aircraft types that have been seen by the ADS-B receiver.
- `aircraft_manufacturers.json` is a dictionary of all manufacturers and model types that have been seen by the ADS-B receiver.
- `aircraft_recently_tracked.json` is a list of aircraft that have been tracked recently by the ADS-B receiver.
- `flight_paths/flight_paths_overview.json` is a list of dates, in unix-epoch time, that have corresponding `flight_path_##########.json`.
- `flight_paths/flight_path_##########.json` is a dictionary containing the paths aircraft have taken in a given day. The data is organized by aircraft ADS-B ICAO into a dictionary of where the keys represent the time the aircraft was first seen and values of an array of messages that contain latitude and longitude coordinates. Aircraft that are seen multiple times a day are recorded as a separate entry after 1 hour.
- `history_complete.json` is a dictionary containing a complete record of every aircraft that has even been seen by the ADS-B receiver.
- `statistics.json`: is a dictionary that contains fields representing the total aircraft seen, the total manufacturers seen, the most frequent aircraft seen, the most frequent aircraft type seen, the total flights seen, and the total callsigns seen.

The data received by ADS-B is augmented by requests made to [ADSBDB](https://www.adsbdb.com) to get more information about the aircraft. The aircraft information, if available, is added to the aircraft’s records.

## Usage

To use, first install Swift on your system from [swift.org](https://www.swift.org/install/linux/debian/12/#versions) or by using an installer and toolchain manager such as [SwiftlyGo](https://github.com/cyberxdruid211/swiftlygo).

Once Swift is installed, cline this repository to your desired folder using the following command: `git clone https://github.com/cfridlington/Swift-ADS-B-Statistics.git`.

With the package installed, you can run the package by using `swift run` inside the `Sources` folder. Alternatively, you can run the command by using the `--package-path` command line argument to specify the path to the folder containing the package. Example: if the package is in your home folder you would use `swift run --package-path /home/usr/Swift-ADS-B-Statistics`. By default the package will look for files in the `/var/run/dump1090-mutability ` directory and will assume there are 120 history files generated. If dump1090-mutability is in a different directory or if you have a different number of history files you can specify these with the following command line arguments:

- `frequentAircraftCount #` is used to specify the number of aircraft in the `aircraft_frequent_tails.json` file.
- `frequentTypesCount #` is used to specify the number of aircraft types in the `aircraft_frequent_types.json` file.
- `--historyFileCount #` is used to specify a different number of history files generated by `dump1090-mutability`. Swift ADS-B Statistics will handle the 0 indexing of files, so a value of 100 will correctly index history_0.json through history_99.json.
- `--inputDirectory /you-path-to/dump1090-mutability` is used to specify a different directory where the `.json` files generated by `dump1090-mutability` are saved.
- `--outputDirectory /file-path-to-save` is used to specify a different directory where generated files will be saved.
- `recentAircraftCount #` is used to specify the number of aircraft in the `aircraft_recently_tracked.json` file.

## Automation

Swift-ADS-B Statistics is designed with automation in mind. While the package itself does not automate calculations, it is designed to be run automatically through a scheduler such as `cron`. The package uses `Codable` to decode and encode data to `.json` files. This ensures data, such as the historical record in `history_complete.json`, are persistent across multiple runs. 

### Example

As an example, here is a cron job that runs every fifteen minutes. Since no command line parameters are specified the default values are used.

```
*/15 * * * * swift run --package-path /home/usr/Swift-ADS-B-Statistics
```

## File Structures

The generated `.json` files each have their own structure optimized for that specific function. The structures for each are described below.

### aircraft_frequent_tails.json

This is a list of aircraft that have been frequently seen by the ADS-B receiver. The list is in descending order with each item containing the following fields.
- `flights` a dictionary mapping callsigns (keys) to the number of times that callsign has been seen (values).
- `hex` is the 24-bit ADS-B ICAO identifier of the aircraft, as 6 hex digits.
-  `lastSeen` is the time, in unix epoch time, that the aircraft was last seen.
- `properties` is *optional field* and if present stores the information fetched from [ADSBDB](https://www.adsbdb.com). The field will contain the following subfields:
	- `icao_type` is the aircraft’s type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format.
	- `manufacturer` is the aircraft’s manufacturer.
	- `registration` is the registration, commonly referred to as the tail number, of the aircraft.
	- `registered_owner_country_name` is the registration country’s name.
	- `registered_owner_country_iso_name` is registration country’s name in [ISO 3166 A2](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes) format.
	- `registered_owner_operator_flag_code` is an *optional field* that signifies the operators [flag code](https://en.wikipedia.org/wiki/List_of_airline_codes) in ICAO format.
	- `registered_owner` is the aircraft’s owner’s name.
	- `type` is the aircraft’s type.
	- `url_photo` is an *optional field* that represents a url to a photo of the aircraft. 
- `timesSeen` is an array of times, in unix epoch time, that the aircraft has been seen.

### aircraft_frequent_types.json
This is a list of aircraft types have been frequently seen by the ADS-B receiver. The list is in descending order with each item has the following fields:

- `aircraft` is a list of 24-bit ICAO identifiers, formatted as 6 hex digits, of the aircrafts of this type seen.
- `icao` is the aircraft’s type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format.
- `lastSeen` is the time, in unix epoch time, that the aircraft was last seen.
- `name` is name of the aircraft’s type.

### aircraft_manufacturers.json
This is a dictionary where each key is the name of the manufacturer and the value is an object that has the following fields:
- `name` is the name of the manufacturer.
- `types` is a dictionary where the keys are an aircraft type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format and the value is an object that with the following fields:
	- `aircraft` is a list of 24-bit ICAO identifiers, formatted as 6 hex digits, of the aircrafts of this type seen.
	- `icao` is the aircraft type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format.
	- `lastSeen` is the time, in unix epoch time, that the aircraft was last seen.
	- `name` is name of the aircraft’s type. 

### aircraft_recently_tracked.json
This is a list of aircraft types have been recently seen by the ADS-B receiver. The list is in descending order with each item containing the following fields:
- `flights` a dictionary mapping callsigns (keys) to the number of times that callsign has been seen (values).
- `hex` is the 24-bit ADS-B ICAO identifier of the aircraft, as 6 hex digits.
-  `lastSeen` is the time, in unix epoch time, that the aircraft was last seen.
- `properties` is *optional field* and if present stores the information fetched from [ADSBDB](https://www.adsbdb.com). The field will contain the following subfields:
	- `icao_type` is the aircraft’s type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format.
	- `manufacturer` is the aircraft’s manufacturer.
	- `registration` is the registration, commonly referred to as the tail number, of the aircraft.
	- `registered_owner_country_name` is the registration country’s name.
	- `registered_owner_country_iso_name` is registration country’s name in [ISO 3166 A2](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes) format.
	- `registered_owner_operator_flag_code` is an *optional field* that signifies the operators [flag code](https://en.wikipedia.org/wiki/List_of_airline_codes) in ICAO format.
	- `registered_owner` is the aircraft’s owner’s name.
	- `type` is the aircraft’s type.
	- `url_photo` is an *optional field* that represents a url to a photo of the aircraft. 
- `timesSeen` is an array of times, in unix epoch time, that the aircraft has been seen.

### flight_paths/flight_paths_overview.json
This is a list of dates, in unix-epoch time, that have corresponding `flight_path_##########.json` files. This can be used to determine which of those files are available.

### flight_paths/flight_path_##########.json
This is a dictionary where each key is an aircraft’s 24-bit ICAO identifiers, formatted as 6 hex digits, and the value is another dictionary where the keys represent the time of a single flights first positional reporting, formatted in unix epoch, and the values are objects with the following fields:
- `adsb` aircraft’s 24-bit ADS-B ICAO identifier.
- `messages` is an array of objects representing ADS-B messages received with positions. *Note: Messages are grouped into flights by checking to see if their transmission times are less than 60 minutes apart.* Each object in the array have the following fields:
	- `latitude` the latitude reported by that message
	- `longitude` the longitude reported but that message

### history_complete.json
This is dictionary containing every aircraft seen by the ADS-B receiver. The dictionary has the following fields:
- `history` is a dictionary containing all the aircraft seen by the ADS-B receiver. The dictionaries keys are the aircraft’s 24-bit ADS-B ICAO identifier and the values are objects with the following fields:
	- `flights` a dictionary mapping callsigns (keys) to the number of times that callsign has been seen (values).
	- `hex` is the 24-bit ADS-B ICAO identifier of the aircraft, as 6 hex digits.
	-  `lastSeen` is the time, in unix epoch time, that the aircraft was last seen.
	- `properties` is *optional field* and if present stores the information fetched from [ADSBDB](https://www.adsbdb.com). The field will contain the following subfields:
		- `icao_type` is the aircraft’s type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format.
		- `manufacturer` is the aircraft’s manufacturer.
		- `registration` is the registration, commonly referred to as the tail number, of the aircraft.
		- `registered_owner_country_name` is the registration country’s name.
		- `registered_owner_country_iso_name` is registration country’s name in [ISO 3166 A2](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes) format.
		- `registered_owner_operator_flag_code` is an *optional field* that signifies the operators [flag code](https://en.wikipedia.org/wiki/List_of_airline_codes) in ICAO format.
		- `registered_owner` is the aircraft’s owner’s name.
		- `type` is the aircraft’s type.
		- `url_photo` is an *optional field* that represents a url to a photo of the aircraft. 
	- `timesSeen` is an array of times, in unix epoch time, that the aircraft has been seen.
- `lastUpdated` is the time, in unix epoch time, that the aircraft was last seen.

### statistics.json
This files serves as a centralized place to access calculated statistics on the data available in the other files. It is useful if you want to quickly get statistics without needing pragmatically count fields in other files. The file has the following fields:
- `aircraftSeen` the total number of unique aircraft seen.
- `mostFrequentAircraft` an object that represents the most frequent aircraft seen. It has the following fields:
	- `flights` a dictionary mapping callsigns (keys) to the number of times that callsign has been seen (values).
	- `hex` is the 24-bit ADS-B ICAO identifier of the aircraft, as 6 hex digits.
	-  `lastSeen` is the time, in unix epoch time, that the aircraft was last seen.
	- `properties` is *optional field* and if present stores the information fetched from [ADSBDB](https://www.adsbdb.com). The field will contain the following subfields:
		- `icao_type` is the aircraft’s type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format.
		- `manufacturer` is the aircraft’s manufacturer.
		- `registration` is the registration, commonly referred to as the tail number, of the aircraft.
		- `registered_owner_country_name` is the registration country’s name.
		- `registered_owner_country_iso_name` is registration country’s name in [ISO 3166 A2](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes) format.
		- `registered_owner_operator_flag_code` is an *optional field* that signifies the operators [flag code](https://en.wikipedia.org/wiki/List_of_airline_codes) in ICAO format.
		- `registered_owner` is the aircraft’s owner’s name.
		- `type` is the aircraft’s type.
		- `url_photo` is an *optional field* that represents a url to a photo of the aircraft. 
	- `timesSeen` is an array of times, in unix epoch time, that the aircraft has been seen.
- `mostFrequentType` an object that represents the most frequent aircraft type seen. It has the following fields:
	- `aircraft` is a list of 24-bit ICAO identifiers, formatted as 6 hex digits, of the aircrafts of this type seen.
	- `icao` is the aircraft type in the [ICAO](https://en.wikipedia.org/wiki/List_of_aircraft_type_designators) format.
	- `lastSeen` is the time, in unix epoch time, that the aircraft was last seen.
	- `name` is name of the aircraft’s type. 
- `totalCallsigns` the total number of unique callsigns seen.
- `totalFlights` the total number of flights seen.
- `totalManufactuers` the total number of unique manufacturers seen.
- `typesSeen` the total number of unique aircraft types seen.

## Example Data
Examples of the files generated by Swift ADS-B Statistics can be found in the [murdock-flight-tracking](https://github.com/cfridlington/murdock-flight-tracking-data) repository. This data comes from [my ADS-B receiver](https://cfridlington.com/misc/flight-tracking) located in the Lakes Region of New Hampshire.
